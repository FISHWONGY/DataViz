**Package**
```{r}
library(tidyverse)
library(ggplot2)
library(ggthemes)
library(lubridate)
library(scales)
library(readr)
library(quanteda)
library(delabj)
library(ggtext)
library(ghibli)
library(patchwork)
#library(cowplot)
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)
library(rgeos)
# library(geonames)
# library(countrycode)
library(rworldmap)
library(patchwork)
library(ggtext)
library(RcppRoll)
library(ggforce)
library(geofacet)
library(ggnewscale)
library(tidytuesdayR)
```
```{r}
tuesdata <- tidytuesdayR::tt_load(2020, week = 32)
energy_types <- tuesdata$energy_types

energy_types <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-08-04/energy_types.csv')
```
```{r}
energy_clean <- energy_types %>% 
  filter(level == "Level 1") %>%
  gather(year, n, 5:7, convert = TRUE) %>% 
  select(-level) %>% 
  mutate(
    country_name = case_when(
      country == "EL" ~ "Greece",
      country == "UK" ~ "United Kingdom",
      TRUE ~ country_name
    ),
    gtype = case_when(
      !type %in% c("Nuclear", "Conventional thermal") ~ "Renewable",
      TRUE ~ type
    )
  ) %>% 
  rename(code = country, name = country_name) %>% 
  rows_update(tibble(code = "MT", type = "Other", year = 2018, n = 172), by = c("code", "type", "year"))

energy_clean
```

```{r geofacet - grid}
eu_grid <- geofacet::eu_grid1
eu_grid[42,] <- list(row = 6, col = 10, code = "GE", name = "Georgia")
eu_grid <- eu_grid %>% 
  filter(!code %in% c("IS", "CH", "BY", "RU", "MD")) %>%
  mutate(name = ifelse(str_detect(name, "Macedonia"), "North Macedonia", name)) %>%
  drop_na()
```

```{r summary}
prop_eu <- energy_clean %>% 
  filter(year == 2018) %>% 
  group_by(name) %>% 
  summarise(
    total = sum(n),
    p_clean = sum(n[gtype != "Conventional thermal"])/total,
  )
```

